<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©”ì¸ í™”ë©´</title>
    <link rel="stylesheet" href="/css/home.css?after"> <!-- ì™¸ë¶€ CSS íŒŒì¼ ë§í¬ -->
</head>
<body>
<div class="header">
    <img src="/defaultImg/PJ9_ì‚¬ì§„.png" alt="ì‚¬ì´íŠ¸ ì†Œê°œ ì´ë¯¸ì§€" class="intro-image" onclick="reloadPage()">
    <form th:action="@{/search}" method="post">
        <!-- ê²€ìƒ‰ ë°” -->
        <div class="search-bar">
            <select id="searchType" name="searchType">
                <option value="title">ì œëª©ì— í¬í•¨</option>
                <option value="titleAndContent">ì œëª©ê³¼ ë‚´ìš©ì— í¬í•¨</option>
            </select>
            <input type="text" id="searchContent" name="searchContent" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            <button type="submit">ê²€ìƒ‰</button>
        </div>
    </form>
    <div class="login" id="login-area">
        <th:block th:if="${sessionId != null}"> <!-- ë¡œê·¸ì¸ ìƒíƒœ -->
            <a href="javascript:void(0);" id="myinfo-link"
               onclick="openSmallWindowNotification('/notice')">ğŸ”” ì•Œë¦¼</a> | |
            <a href="javascript:void(0);" id="info-link" onclick="openSmallWindowMyInfo('/notice')">ğŸ”’ ë‚´
                ì •ë³´</a> | |
            <a th:href="@{/logout}" id="logout-link">ğŸ‘‹ ë¡œê·¸ì•„ì›ƒ</a> | |
            <a th:href="@{/create/board}" id="create-link">ğŸ“ ê¸€ ì‘ì„±</a> | |
            <a href="javascript:void(0);" id="mychat-list" onclick="openSmallWindowChat('/chat/list')">ğŸ“§
                ì±„íŒ…</a>
        </th:block>
        <th:block th:if="${sessionId == null}"> <!-- ë¹„ë¡œê·¸ì¸ ìƒíƒœ -->
            <a th:href="@{/signin}" id="login-link">ë¡œê·¸ì¸</a>
        </th:block>
    </div>
</div>

<div class="content">
    <div class="post-section" id="all-posts">
        <h3>ì „ì²´ ê²Œì‹œê¸€</h3>
        <div class="post-list">
            <th:block th:each="post, iterStat : ${posts}" th:if="${iterStat.index < 20}"> <!-- ìµœëŒ€ 20ê°œ ê²Œì‹œê¸€ -->
                <div class="post">
                    <h4 th:text="${post.title}">ê²Œì‹œê¸€ ì œëª©</h4>
                    <p class="author" th:text="${post.author.userId}" onclick="toggleDropdown(event)">ì‘ì„±ì</p>
                    <div class="dropdown" style="display: none;">
                        <ul>
                            <li class="dropdown-item" onclick="searchId()">IDë¡œ ê²€ìƒ‰</li>
                            <li class="dropdown-item" onclick="openSmallWindowChatContent()">ì±„íŒ…í•˜ê¸°</li>
                        </ul>
                    </div>
                    <p class="created-at" th:text="${post.createdAt}">ì‘ì„± ì‹œê°„</p>
                    <a th:href="@{/board/{postNum}(postNum=${post.postNum})}">ìì„¸íˆ ë³´ê¸°</a>
                </div>
            </th:block>
        </div>
    </div>

    <div class="post-section" id="member-search">
        <h3>íŒ€ì› êµ¬í•¨</h3>
        <div class="post-list">
            <th:block th:each="post, iterStat : ${posts}" th:if="${post.boardType == 'member_search'}">
                <!-- ìµœëŒ€ 10ê°œ ê²Œì‹œê¸€ -->
                <div class="post">
                    <h4 th:text="${post.title}">ê²Œì‹œê¸€ ì œëª©</h4>
                    <p class="author" th:text="${post.author.userId}" onclick="toggleDropdown(event)">ì‘ì„±ì</p>
                    <div class="dropdown" style="display: none;">
                        <ul>
                            <li class="dropdown-item" onclick="searchId()">IDë¡œ ê²€ìƒ‰</li>
                            <li class="dropdown-item" onclick="openSmallWindowChatContent()">ì±„íŒ…í•˜ê¸°</li>
                        </ul>
                    </div>
                    <p class="created-at" th:text="${post.createdAt}">ì‘ì„± ì‹œê°„</p>
                    <a th:href="@{/board/{postNum}(postNum=${post.postNum})}">ìì„¸íˆ ë³´ê¸°</a>
                </div>
            </th:block>
        </div>
    </div>

    <div class="post-section" id="team-search">
        <h3>íŒ€ êµ¬í•¨</h3>
        <div class="post-list">
            <th:block th:each="post, iterStat : ${posts}" th:if="${post.boardType == 'team_search'}">
                <!-- ìµœëŒ€ 10ê°œ ê²Œì‹œê¸€ -->
                <div class="post">
                    <h4 th:text="${post.title}">ê²Œì‹œê¸€ ì œëª©</h4>
                    <p class="author" th:text="${post.author.userId}" onclick="toggleDropdown(event)">ì‘ì„±ì</p>
                    <div class="dropdown" style="display: none;">
                        <ul>
                            <li class="dropdown-item" onclick="searchId()">IDë¡œ ê²€ìƒ‰</li>
                            <li class="dropdown-item" onclick="openSmallWindowChatContent()">ì±„íŒ…í•˜ê¸°</li>
                        </ul>
                    </div>
                    <p class="created-at" th:text="${post.createdAt}">ì‘ì„± ì‹œê°„</p>
                    <a th:href="@{/board/{postNum}(postNum=${post.postNum})}">ìì„¸íˆ ë³´ê¸°</a>
                </div>
            </th:block>
        </div>
    </div>
</div>

<script>

    const baseUrl = window.location.origin;

    function reloadPage() {
        location.replace(baseUrl + "/"); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
    }

    function openSmallWindow(url) {
        window.open(baseUrl + url, '_blank', 'width=800,height=400'); // ì‘ì€ ì°½ ì—´ê¸°
    }

    function openSmallWindowChat(url) {
        window.open(baseUrl + url, '_blank', 'width=400,height=800'); // ì‘ì€ ì°½ ì—´ê¸°
    }


    function openSmallWindowMyInfo(url) {
        window.open(baseUrl + url, '_blank', 'width=800,height=500'); // ì‘ì€ ì°½ ì—´ê¸°
    }

    function openSmallWindowChatContent() {
        const url = baseUrl + `/chat/${event.target.closest('.post').querySelector('.author').textContent}`;
        window.open(url, '_blank', 'width=550,height=950'); // ì‘ì€ ì°½ ì—´ê¸°
    }

    function searchId() {
        const targetUserId = event.target.closest('.post').querySelector('.author').textContent;
        console.log("ê²€ìƒ‰í•  ì•„ì´ë”” : " + targetUserId);
        location.href = baseUrl + `/search/${targetUserId}`;
    }

    // ì‘ì„±ìë¥¼ í´ë¦­í•  ë•Œ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ë¥¼ í† ê¸€í•˜ëŠ” í•¨ìˆ˜
    function toggleDropdown(event) {
        // ì‘ì„±ì ì´ë¦„ ë°”ë¡œ ì•„ë˜ì— ìˆëŠ” .dropdown ìš”ì†Œë¥¼ ì°¾ìŒ
        const dropdown = event.target.nextElementSibling;

        // ë“œë¡­ë‹¤ìš´ ë©”ë‰´ì˜ í‘œì‹œ ìƒíƒœë¥¼ ë°˜ì „ì‹œí‚´ (ë³´ì´ê±°ë‚˜ ìˆ¨ê¸°ê¸°)
        if (dropdown.style.display === "none" || dropdown.style.display === "") {
            dropdown.style.display = "block";
        } else {
            dropdown.style.display = "none";
        }
    }

</script>
</body>
</html>
